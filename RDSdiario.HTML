<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>RDS — Relatório Diário de Serviço (Gerador)</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
  :root{--paper-w:794px;--muted:#666}
  body{font-family:"Arial",Helvetica,sans-serif;background:#f2f4f7;margin:0;padding:18px}
  .container{max-width:900px;margin:0 auto}
  .card{background:#fff;border-radius:8px;padding:16px;box-shadow:0 8px 20px rgba(0,0,0,0.06)}
  h1{font-size:18px;margin:0 0 12px}
  .row{display:flex;gap:12px;flex-wrap:wrap}
  .col{flex:1;min-width:150px;display:flex;flex-direction:column;margin-bottom:8px}
  label{font-size:13px;margin-bottom:6px;color:#222}
  input[type=text],input[type=date],select,textarea{padding:8px;border:1px solid #ddd;border-radius:6px;font-size:14px;background:#fff}
  textarea{resize:vertical}
  .small{max-width:170px}
  .btn{display:inline-block;background:#0b73d6;color:#fff;border:none;padding:10px 14px;border-radius:8px;font-size:14px;cursor:pointer}
  .btn.gray{background:#6c757d}
  .table{width:100%;border-collapse:collapse;margin-top:12px}
  .table th,.table td{border:1px solid #dcdcdc;padding:8px;font-size:13px;text-align:left}
  .table th{background:#f7f7f7}
  .actions{margin-top:12px;display:flex;gap:8px;flex-wrap:wrap;align-items:center}
  .muted{color:var(--muted);font-size:13px}
  .rds-paper{width:var(--paper-w);padding:24px;background:#fff;color:#111;box-sizing:border-box;font-size:13px}
  .rds-header{display:flex;justify-content:space-between;gap:12px;align-items:flex-start}
  .rds-meta{font-size:12px}
  .rds-table{width:100%;border-collapse:collapse;margin-top:8px}
  .rds-table td,.rds-table th{border:1px solid #333;padding:6px;font-size:12px}
  .rds-foot{margin-top:12px;display:flex;gap:12px;align-items:center;justify-content:space-between}
  .sig{display:flex;flex-direction:column;gap:6px;width:45%}
  .sig .line{height:36px;border-bottom:1px solid #000}
  .remove-btn{background:#dc3545;color:#fff;border:none;padding:6px 8px;border-radius:6px;cursor:pointer}
</style>
</head>
<body>
<div class="container">
  <div class="card">
    <h1>Gerador de RDS — Relatório Diário de Serviço</h1>

    <div class="row">
      <div class="col small"><label>Data</label><input id="rds_data" type="date"></div>
      <div class="col small"><label>Hora do Documento</label><input id="rds_hora_doc" type="text" readonly></div>
      <div class="col"><label>Contratante</label><input id="rds_contratante" type="text" placeholder="Contratante"></div>
      <div class="col">
        <label>Funcionário</label>
        <select id="rds_servico">
          <option value="">Selecione...</option>
          <!-- Esse select do cabeçalho usa a mesma base de funcionários -->
        </select>
      </div>
    </div>

    <div class="row">
      <div class="col"><label>Horário de Trabalho</label><input id="rds_horario_trabalho" type="text" placeholder="Ex: 07:00 às 16:48 - SEG A SEX"></div>
      <div class="col"><label>Fábrica / Local</label><input id="rds_fabrica" type="text" placeholder="Local de trabalho"></div>
    </div>

    <div style="margin-top:8px" class="row">
      <div class="col"><label>Diálogo Diário de Segurança (DDS) — Tema</label><input id="rds_tema" type="text" placeholder="Tema do DDS"></div>
      <div class="col small"><label>Horário do DDS</label><input id="rds_horario_dds" type="text" placeholder="Ex: 07:00"></div>
    </div>

    <hr style="margin:12px 0">

    <div style="display:flex;align-items:center;justify-content:space-between">
      <div class="muted">Tabela de funcionários (20 linhas automáticas)</div>
      <button id="btnAdd" class="btn">Adicionar linha</button>
    </div>

    <table class="table" id="tblFuncionarios">
      <thead>
        <tr>
          <th style="width:80px">Código</th>
          <th>Funcionário</th>
          <th style="width:100px">Entrada</th>
          <th style="width:100px">Saída</th>
          <th>Observação</th>
          <th style="width:70px">Ações</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <div class="actions">
      <button id="btnGerarPDF" class="btn">Gerar PDF</button>
      <button id="btnLimpar" class="btn gray">Limpar</button>
      <div class="muted">Arquivo: <strong>RDS_FUNCIONARIO_DD-MM-AAAA_HH-MM.pdf</strong></div>
    </div>
  </div>
</div>

<!-- area do paper (mantida igual ao original) -->
<div id="paper" style="display:none">
  <div class="rds-paper" id="rds_report">
    <div class="rds-header">
      <div>
        <div style="font-size:12px">COMERCIAL ARCOS LTDA</div>
        <div style="font-size:11px;color:#333;margin-top:4px">
          ROD BR 354, KM 474, Nº 749 - VILA CALCITA - ARCOS/MG - CEP: 35600-350
        </div>
      </div>
      <div style="text-align:right">
        <div style="font-weight:700">RELATÓRIO DIÁRIO DE SERVIÇO (RDS)</div>
        <div class="rds-meta" id="meta_data">DATA:</div>
        <div class="rds-meta" id="meta_hora_doc">HORA:</div>
      </div>
    </div>

    <table class="rds-table" style="margin-top:12px">
      <tr>
        <td><strong>CONTRATANTE:</strong><div id="meta_contratante"></div></td>
        <td><strong>FUNCIONÁRIO:</strong><div id="meta_servico"></div></td>
        <td><strong>FÁBRICA / LOCAL:</strong><div id="meta_fabrica"></div></td>
      </tr>
      <tr>
        <td><strong>HORÁRIO DE TRABALHO:</strong><div id="meta_horario_trabalho"></div></td>
        <td><strong>TEMA (DDS):</strong><div id="meta_tema"></div></td>
        <td><strong>HORÁRIO DO DDS:</strong><div id="meta_horario_dds"></div></td>
      </tr>
    </table>

    <table class="rds-table" id="rds_table_func" style="margin-top:12px">
      <thead>
        <tr>
          <th style="width:60px">CÓDIGO</th>
          <th>NOME</th>
          <th style="width:80px">ENTRADA</th>
          <th style="width:80px">SAÍDA</th>
          <th>OBSERVAÇÃO</th>
        </tr>
      </thead>
      <tbody id="rds_func_rows"></tbody>
    </table>

    <div style="margin-top:10px;font-size:12px">
      <strong>DIÁLOGO DIÁRIO DE SEGURANÇA (DDS)</strong>
      <div id="rds_dds" style="margin-top:6px;min-height:36px"></div>
    </div>

    <div class="rds-foot">
      <div class="sig">
        <div style="font-size:12px">ASSINATURA ENCARREGADO DA CONTRATADA</div>
        <div class="line"></div>
      </div>
      <div class="sig">
        <div style="font-size:12px">ASSINATURA GESTOR DO CONTRATO</div>
        <div class="line"></div>
      </div>
    </div>
  </div>
</div>

<script>
(function(){
  const $ = id => document.getElementById(id);
  const tblBody = document.querySelector('#tblFuncionarios tbody');

  // Base completa de funcionários (código e nome conforme você forneceu)
  const funcionarios = [
{codigo:"00225",nome:"WANTUIR BERTOLDO DA SILVA"},
{codigo:"01350",nome:"MARIA DA CONCEICAO ARANTES"},
{codigo:"01395",nome:"SANDRA APARECIDA VIEIRA SOUZA"},
{codigo:"01450",nome:"SERGIO HENRIQUE SIMOES"},
{codigo:"01462",nome:"ROSILENE ELIAS DE SOUZA"},
{codigo:"01519",nome:"DJALMA DE SOUSA PRATES"},
{codigo:"01532",nome:"EDINAR MELO DE SOUSA EDUARDO"},
{codigo:"01541",nome:"SILVIO AUGUSTO DE ASSIS"},
{codigo:"01542",nome:"PEDRO JOSE DA SILVA"},
{codigo:"01566",nome:"VALQUIRIA DO NASCIMENTO DA SILVA"},
{codigo:"01586",nome:"GENI ALVES XAVIER"},
{codigo:"01648",nome:"JULIANA MARIA DE RESENDE ADRIANO"},
{codigo:"01719",nome:"MARQUES CARLOS DE CASTRO"},
{codigo:"01759",nome:"MARCOS BATISTA PEREIRA"},
{codigo:"01767",nome:"VALDECIRO MELQUIADES DE OLIVEIRA"},
{codigo:"01776",nome:"RICARDO JUNIO BELIZARIO"},
{codigo:"01807",nome:"MICHELINE JOSE COUTINHO DO VALE"},
{codigo:"01811",nome:"JOSE ANTONIO DA SILVA"},
{codigo:"01818",nome:"ABGAIR DE JESUS DA SILVA"},
{codigo:"01844",nome:"JANE OLIVEIRA GUSMÃO"},
{codigo:"01849",nome:"JORDANIA APARECIDA LOPES"},
{codigo:"01853",nome:"SERGIO MAXIMIANO DA SILVA"},
{codigo:"01854",nome:"JOSE SOARES JUNIOR"},
{codigo:"01857",nome:"DANIELE CAMPOS DE ASSUNÇÃO"},
{codigo:"01886",nome:"NAIBIA MARIA SOUZA LIMA"},
{codigo:"01900",nome:"EDER DE ARAUJO SILVA"},
{codigo:"01906",nome:"JADER LUIS DA SILVA"},
{codigo:"01908",nome:"JESSICA SILVA RIBEIRO"},
{codigo:"01909",nome:"MARCELO AUGUSTO DE OLIVEIRA"},
{codigo:"01911",nome:"MARCELO APARECIDO LACERDA"},
{codigo:"01912",nome:"DIEGO JOSE RODRIGUES"},
{codigo:"01915",nome:"DIOGO DUQUE MARCELINO"},
{codigo:"01919",nome:"ISABELLA GONZAGA RIBEIRO"},
{codigo:"01924",nome:"APARECIDA MANOEL DA COSTA RODRIGUES"},
{codigo:"01925",nome:"RICARDO JUNIOR RIBEIRO MOURA"},
{codigo:"01927",nome:"RONIELE CORREA MARTINS"},
{codigo:"01928",nome:"LENILDO DOS SANTOS CHAVES"},
{codigo:"01935",nome:"RILDO CANDIDO"},
{codigo:"01937",nome:"EDVALDO VIEIRA DA SILVA"},
{codigo:"01944",nome:"ADEONES PAULO DA SILVA"},
{codigo:"01945",nome:"FERNANDA TEIXEIRA COUTO"},
{codigo:"01946",nome:"PERPÉTUA APARECIDA MARÇAL"},
{codigo:"01955",nome:"DANIEL JUNIO MARÇAL"},
{codigo:"01957",nome:"ROGERIO EDUARDO OLIVEIRA"},
{codigo:"01962",nome:"SIRLEIA REGINA DE FARIA SILVA"},
{codigo:"01965",nome:"HENRIQUE MAGNO SANTOS ALMEIDA"},
{codigo:"01967",nome:"IGOR APARECIDO GONZAGA"},
{codigo:"01969",nome:"JULIANO UMBERTO DE SALES SILVA"},
{codigo:"01970",nome:"JEANCARLOS JUNIOR DA SILVA"},
{codigo:"01971",nome:"MONICA GONÇALVES COSTA"},
{codigo:"01973",nome:"DAIANE LIMA NOGUEIRA"},
{codigo:"01977",nome:"ISILEI DE FATIMA SILVA"},
{codigo:"01979",nome:"CARLOS ALBERTO MARRERO MEDINA"},
{codigo:"01981",nome:"GABRIEL DE PAULA MORAIS"},
{codigo:"01982",nome:"CLEONE NASCIMENTO RODRIGUES"},
{codigo:"01983",nome:"SANDRA APARECIDA BORGES"},
{codigo:"01984",nome:"RENAN PAULINO ALVES GUIMARAES"},
{codigo:"01987",nome:"VAGNER DOMINGOS DE MORAES"},
{codigo:"01988",nome:"REINALDO FRANCISCO LOPES"},
{codigo:"01989",nome:"MARIANA APARECIDA NUNES DE MELO"},
{codigo:"01990",nome:"LUIS ANTONIO LOPES VELOSO"},
{codigo:"01991",nome:"NATALIA MARCIANA DE OLIVEIRA SOUZA"},
{codigo:"01992",nome:"DOUGLAS TEIXEIRA DOS SANTOS"},
{codigo:"01993",nome:"BRUNO HENRIQUE MORAIS FERREIRA"},
{codigo:"01994",nome:"MIRELLE DA SILVA RIBEIRO"},
{codigo:"01996",nome:"HEITOR EUSTAQUIO ALVES"},
{codigo:"01997",nome:"DAISIO APARECIDO OLIVEIRA"},
{codigo:"01998",nome:"RHAONNI MEGARON QUEROBINO"},
{codigo:"01999",nome:"GEOVANE DO AMARAL GOMES"},
{codigo:"02000",nome:"WILLIAN DOS SANTOS EVANGELINO"},
{codigo:"02001",nome:"FABIANO GERALDO MARTINS"},
{codigo:"02002",nome:"EDER LUIS DUQUE"},
{codigo:"02003",nome:"JOÃO VICTOR SANTOS"},
{codigo:"02004",nome:"RODRIGO SOUZA AIRES"},
{codigo:"02005",nome:"CRISTINA LOPES GOMES"},
{codigo:"02006",nome:"JOSE MARIA DA COSTA"},
{codigo:"02007",nome:"RAMON AUGUSTO DA SILVA COSTA"},
{codigo:"02008",nome:"GABRIEL WHAGNOM NOGUEIRA LIMA"},
{codigo:"02009",nome:"VANDER DE PAULA CANDIDO"},
{codigo:"02010",nome:"MARDEN ALVES BATISTA"},
{codigo:"02011",nome:"ANDER APARECIDO DA SILVA"},
{codigo:"02012",nome:"EDEILSON ALVE PEREIRA"},
{codigo:"02013",nome:"ISAC LIRIO LUIZ"},
{codigo:"02014",nome:"PAULO HENRIQUE RODRIGUES DA SILVA"},
{codigo:"02015",nome:"ROGERIO HENRIQUE BRITO DO PRADO"},
{codigo:"02016",nome:"AGNALDO CRISPIM DA SILVA"},
{codigo:"02017",nome:"ANNA VITORIA TAVARES DA PAIXAO"},
{codigo:"02018",nome:"MAICON SANTOS LIMA"},
{codigo:"02019",nome:"JUNIOR WESLEY MESSIAS"},
{codigo:"02020",nome:"JUSCELINA GONÇALVES DE OLIVEIRA"},
{codigo:"02021",nome:"EBERSON DAVID DA SILVA LIMA"},
{codigo:"02022",nome:"GABRIELA MARTINS CALIXTO"},
{codigo:"02023",nome:"GEYCILAYNE TELES SANTOS"},
{codigo:"02024",nome:"JAQUELINE NAZARE ROMAO"},
{codigo:"02025",nome:"ANDRE LOPES SILVA"},
{codigo:"02026",nome:"WESLIAN XUXA SILVIA MELINDA SOARES DE PONTES"},
{codigo:"02027",nome:"FLAVIA ALMEIDA ALVES SAMPAIO"},
{codigo:"02028",nome:"BRUNO DOS REIS SOUSA"},
{codigo:"02029",nome:"VALDER LEOPOLDINO OLIVEIRA MACHADO"},
{codigo:"02030",nome:"AILAN ARNALDO VELOSO"},
{codigo:"02031",nome:"IRANDI ROSA BRITO"},
{codigo:"02032",nome:"EUGENIO FONSECA DA COSTA DIAS"},
{codigo:"02033",nome:"TIAGO ALEXANDRE DA COSTA"},
{codigo:"02034",nome:"PAULO HENRIQUE BRITO"},
{codigo:"02035",nome:"ANDREA APARECIDA TOME DA SILVA"}
  ];

  // preenche select do cabeçalho (rds_servico) com nomes dos funcionários
  const headerSelect = $('rds_servico');
  funcionarios.forEach(f=>{
    const o = document.createElement('option');
    o.value = f.nome;
    o.textContent = f.nome;
    headerSelect.appendChild(o);
  });

  function criarSelectFuncionario(selected){
    const s=document.createElement('select');
    const opt=document.createElement('option');
    opt.value=""; opt.textContent="Selecione...";
    s.appendChild(opt);
    funcionarios.forEach(item=>{
      const o=document.createElement('option');
      o.value=item.nome;
      o.textContent=item.nome;
      if(selected===item.nome) o.selected=true;
      s.appendChild(o);
    });
    return s;
  }

  function addRow(data={}){
    const tr=document.createElement('tr');
    const tdCodigo=document.createElement('td');
    const tdFuncionario=document.createElement('td');

    const inputCodigo=document.createElement('input');
    inputCodigo.type='text';
    inputCodigo.value=data.codigo||'';
    inputCodigo.placeholder='Código';

    const selectFuncionario=criarSelectFuncionario(data.nome);

    // ligação automática bidirecional
    inputCodigo.addEventListener('input',()=>{
      const match=funcionarios.find(s=>s.codigo===inputCodigo.value.trim());
      if(match) selectFuncionario.value=match.nome;
      else if (inputCodigo.value.trim()==='') selectFuncionario.value='';
    });
    selectFuncionario.addEventListener('change',()=>{
      const match=funcionarios.find(s=>s.nome===selectFuncionario.value);
      if(match) inputCodigo.value=match.codigo;
      else inputCodigo.value='';
    });

    tdCodigo.appendChild(inputCodigo);
    tdFuncionario.appendChild(selectFuncionario);

    tr.innerHTML+=`
      <td></td><td></td>
      <td><input type="text" placeholder="Entrada" style="width:100%"></td>
      <td><input type="text" placeholder="Saída" style="width:100%"></td>
      <td><input type="text" placeholder="Observação" style="width:100%"></td>
      <td><button class="remove-btn">Remover</button></td>`;

    tr.children[0].replaceWith(tdCodigo);
    tr.children[1].replaceWith(tdFuncionario);

    tr.querySelector('.remove-btn').onclick=()=>tr.remove();
    tblBody.appendChild(tr);
  }

  // inicia com 20 linhas
  for(let i=0;i<20;i++) addRow({});

  // adicionar linha
  $('btnAdd').onclick = ()=> addRow({});

  // limpar
  $('btnLimpar').onclick = ()=>{
    ['rds_contratante','rds_servico','rds_fabrica','rds_tema','rds_horario_dds'].forEach(id=>$(id).value='');
    tblBody.innerHTML=''; for(let i=0;i<20;i++) addRow({});
  };

  // Função coletar funcionários para montar o PDF
  function coletarFuncionarios() {
    return Array.from(tblBody.querySelectorAll('tr')).map(r=>{
      const inputs = r.querySelectorAll('input, select');
      // inputs order: codigo(input), funcionario(select), entrada(input), saida(input), obs(input), remove(button)
      const codigo = inputs[0] ? inputs[0].value.trim() : '';
      const nome = inputs[1] ? inputs[1].value.trim() : '';
      const entrada = inputs[2] ? inputs[2].value.trim() : '';
      const saida = inputs[3] ? inputs[3].value.trim() : '';
      const obs = inputs[4] ? inputs[4].value.trim() : '';
      return {codigo,nome,entrada,saida,obs};
    }).filter(x=>x.codigo||x.nome||x.entrada||x.saida||x.obs);
  }

  // Preenche hora e data iniciais
  const today = new Date();
  $('rds_data').value = today.toISOString().slice(0,10);
  $('rds_hora_doc').value = today.toLocaleTimeString('pt-BR', {hour: '2-digit', minute: '2-digit'});
  $('rds_horario_trabalho').value = '07:00 ÀS 16:48 - SEG A SEX';

  // Geração do PDF (mantido do seu código original, com paginação)
  async function gerarPDF(){
    const dataISO=$('rds_data').value;
    const dataFormatada=new Date(dataISO).toLocaleDateString('pt-BR');
    const horaDoc=$('rds_hora_doc').value;
    const contratante=$('rds_contratante').value.trim();
    const servico=$('rds_servico').value.trim(); // guarda o funcionario selecionado no cabeçalho
    const fabrica=$('rds_fabrica').value.trim();
    const horario=$('rds_horario_trabalho').value.trim();
    const tema=$('rds_tema').value.trim();
    const horarioDDS=$('rds_horario_dds').value.trim();
    const funcionariosList=coletarFuncionarios();

    $('meta_data').innerText='DATA: '+(dataFormatada||'-');
    $('meta_hora_doc').innerText='HORA: '+(horaDoc||'-');
    $('meta_contratante').innerText=contratante||'-';
    $('meta_servico').innerText=servico||'-';
    $('meta_fabrica').innerText=fabrica||'-';
    $('meta_horario_trabalho').innerText=horario||'-';
    $('meta_tema').innerText=tema||'-';
    $('meta_horario_dds').innerText=horarioDDS||'-';
    $('rds_dds').innerText=tema||'-';

    const tbody=$('rds_func_rows');
    tbody.innerHTML='';
    funcionariosList.forEach(f=>{
      const tr=document.createElement('tr');
      tr.innerHTML=`<td>${f.codigo||'-'}</td><td>${f.nome||'-'}</td><td>${f.entrada||'-'}</td><td>${f.saida||'-'}</td><td>${f.obs||'-'}</td>`;
      tbody.appendChild(tr);
    });

    const dataFile=dataFormatada.replaceAll('/','-');
    const nomeArquivo=`RDS_${(servico||'SEM_NOME').replace(/[^a-z0-9_-]/gi,'_')}_${dataFile}_${horaDoc.replace(/[:]/g,'-')}.pdf`;

    const wrapper=$('rds_report').cloneNode(true);
    wrapper.style.position='fixed';wrapper.style.left='-9999px';
    document.body.appendChild(wrapper);
    const canvas=await html2canvas(wrapper,{scale:2});
    const img=canvas.toDataURL('image/png');
    const {jsPDF}=window.jspdf;
    const pdf=new jsPDF({unit:'pt',format:'a4'});
    const pageHeight=pdf.internal.pageSize.height;
    const imgWidth=pdf.internal.pageSize.width;
    const imgHeight=(canvas.height*imgWidth)/canvas.width;

    let heightLeft=imgHeight;
    let position=0;

    pdf.addImage(img,'PNG',0,position,imgWidth,imgHeight);
    heightLeft -= pageHeight;

    while(heightLeft>0){
      position -= pageHeight;
      pdf.addPage();
      pdf.addImage(img,'PNG',0,position,imgWidth,imgHeight);
      heightLeft -= pageHeight;
    }

    pdf.save(nomeArquivo);
    document.body.removeChild(wrapper);
  }

  $('btnGerarPDF').onclick=gerarPDF;

})();
</script>
</body>
</html>
