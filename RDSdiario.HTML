<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>RDS ‚Äî Relat√≥rio Di√°rio de Servi√ßo (Gerador)</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<style>
  :root {
    --paper-w: 794px;
    --muted: #666;
  }

  body {
    font-family: "Arial", Helvetica, sans-serif;
    background: #f2f4f7;
    margin: 0;
    padding: 18px;
  }

  .container {
    max-width: 900px;
    margin: 0 auto;
  }

  .card {
    background: #fff;
    border-radius: 10px;
    padding: 18px;
    box-shadow: 0 6px 18px rgba(0, 0, 0, 0.08);
  }

  h1 {
    font-size: 18px;
    margin: 0 0 12px;
  }

  .row {
    display: flex;
    gap: 12px;
    flex-wrap: wrap;
  }

  .col {
    flex: 1;
    min-width: 150px;
    display: flex;
    flex-direction: column;
    margin-bottom: 8px;
  }

  label {
    font-size: 13px;
    margin-bottom: 6px;
    color: #222;
  }

  input[type=text],
  input[type=date],
  select,
  textarea {
    padding: 8px;
    border: 1px solid #ddd;
    border-radius: 6px;
    font-size: 14px;
    background: #fff;
    width: 100%;
    box-sizing: border-box;
  }

  textarea {
    resize: vertical;
  }

  .small {
    max-width: 170px;
  }

  .btn {
    display: inline-block;
    background: #0b73d6;
    color: #fff;
    border: none;
    padding: 10px 14px;
    border-radius: 8px;
    font-size: 14px;
    cursor: pointer;
    transition: background 0.3s;
  }

  .btn:hover {
    background: #0959a8;
  }

  .btn.gray {
    background: #6c757d;
  }

  .table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 12px;
    background: #f8f9fa;
    border-radius: 8px;
    overflow: hidden;
  }

  .table th,
  .table td {
    border: 1px solid #dcdcdc;
    padding: 8px;
    font-size: 13px;
    text-align: left;
  }

  .table th {
    background: #f1f3f5;
  }

  .table td select,
  .table td input {
    font-size: 13px;
  }

  .actions {
    margin-top: 12px;
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    align-items: center;
    justify-content: flex-start;
  }

  .muted {
    color: var(--muted);
    font-size: 13px;
  }

  .rds-paper {
    width: var(--paper-w);
    padding: 24px;
    background: #fff;
    color: #111;
    box-sizing: border-box;
    font-size: 13px;
  }

  .rds-header {
    display: flex;
    justify-content: space-between;
    gap: 12px;
    align-items: flex-start;
  }

  .rds-meta {
    font-size: 12px;
  }

  .rds-table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 8px;
  }

  .rds-table td,
  .rds-table th {
    border: 1px solid #333;
    padding: 6px;
    font-size: 12px;
  }

  .rds-foot {
    margin-top: 12px;
    display: flex;
    gap: 12px;
    align-items: center;
    justify-content: space-between;
  }

  .sig {
    display: flex;
    flex-direction: column;
    gap: 6px;
    width: 45%;
  }

  .sig .line {
    height: 36px;
    border-bottom: 1px solid #000;
  }

  .remove-btn {
    background: #dc3545;
    color: #fff;
    border: none;
    padding: 6px 8px;
    border-radius: 6px;
    cursor: pointer;
  }

  /* üîß Melhor adapta√ß√£o dos "cards" e tabela para celular e desktop */
  @media (max-width: 768px) {
    .container {
      padding: 8px;
    }

    .card {
      padding: 14px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    }

    h1 {
      font-size: 16px;
      text-align: center;
    }

    .row {
      flex-direction: column;
      gap: 8px;
    }

    .table {
      display: block;
      overflow-x: auto;
      border-radius: 6px;
    }

    .table th,
    .table td {
      font-size: 12px;
      padding: 6px;
    }

    .actions {
      flex-direction: column;
      align-items: stretch;
      text-align: center;
    }

    .btn {
      width: 100%;
    }
  }

  @media (min-width: 769px) {
    .table {
      margin-top: 16px;
    }

    .actions {
      justify-content: space-between;
    }
  }
</style>


</head>
<body>
<div class="container">
  <div class="card">
    <h1>Gerador de RDS ‚Äî Relat√≥rio Di√°rio de Servi√ßo</h1>

    <div class="row">
      <div class="col small"><label>Data</label><input id="rds_data" type="date"></div>
      <div class="col small"><label>Hora do Documento</label><input id="rds_hora_doc" type="text" readonly></div>
      <div class="col">
        <label>Contratante</label>
        <select id="rds_contratante">
          <option value="">Selecione...</option>
          <option>Minera√ß√£o Belocal</option>
          <option>Lhoist</option>
        </select>
      </div>
      <div class="col">
       <label>Servi√ßo</label>
        <select id="rds_servico">
          <option value="">Selecione...</option>
          <option>LIMP ADMINISTRATIVA - ARCOS</option>
          <option>LIMP ADMINISTRATIVA - LIMEIRA</option>
          <option>LIMP ADMINISTRATIVA - DORESOPOLIS</option>
          <option>LIMP INDUSTRIAL FORNOS AZBE</option>
          <option>LIMP INDUSTRIAL FORNOS MAERZ</option>
          <option>LIMP INDUSTRIAL BRITAGEM</option>
          <option>LIMP INDUSTRIAL MOAGEM 01 e 02 CARBONATOS</option>
          <option>LIMPEZA BALAN√áA</option>
          <option>ALMOXARIFE I</option>
          <option>ALMOXARIFE II</option>
          <option>OPERADOR DE LOGISTICA</option>
                   <option>MEC√ÇNICO (MANUTEN√á√ÉO DE EQUIPAMENTO)</option>
                   <option>LIMP. INDUSTRIAL DRS</option>
               <option>LIMPEZA INDUSTRIAL - SPOT</option>
          <option>LIMPEZA INDUSTRIAL - ALMOXARIFADO</option>
                  </select>
      </div>
    </div>

    <div class="row">
      <div class="col"><label>Hor√°rio de Trabalho</label><input id="rds_horario_trabalho" type="text" placeholder="Ex: 07:00 √†s 16:48 - SEG A SEX"></div>
      <div class="col"><label>F√°brica / Local</label><input id="rds_fabrica" type="text" placeholder="Local de trabalho"></div>
    </div>

    <div style="margin-top:8px" class="row">
      <div class="col"><label>Di√°logo Di√°rio de Seguran√ßa (DDS) ‚Äî Tema</label><input id="rds_tema" type="text" placeholder="Tema do DDS"></div>
      <div class="col small"><label>Hor√°rio do DDS</label><input id="rds_horario_dds" type="text" placeholder="Ex: 07:00"></div>
    </div>

    <hr style="margin:12px 0">

    <div style="display:flex;align-items:center;justify-content:space-between">
      <div class="muted">Tabela de funcion√°rios (20 linhas autom√°ticas)</div>
      <button id="btnAdd" class="btn">Adicionar linha</button>
    </div>

    <table class="table" id="tblFuncionarios">
      <thead>
        <tr>
          <th style="width:80px">C√≥digo</th>
          <th>Funcion√°rio</th>
          <th style="width:100px">Entrada</th>
          <th style="width:100px">Sa√≠da</th>
          <th>Observa√ß√£o</th>
          <th style="width:70px">A√ß√µes</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <div class="actions">
      <button id="btnGerarPDF" class="btn">Gerar PDF</button>
      <button id="btnLimpar" class="btn gray">Limpar</button>
<button id="btnExcelRDS" class="btn gray">Gerar Excel</button>
      <div class="muted">Arquivo: <strong>RDS_SERVICO_DD-MM-AAAA_HH-MM.pdf</strong></div>
    </div>
  </div>
</div>

<!-- √°rea oculta para gerar o PDF -->
<div id="paper" style="display:none">
  <div class="rds-paper" id="rds_report">
    <div class="rds-header">
      <div>
        <div style="font-size:12px">COMERCIAL ARCOS LTDA</div>
        <div style="font-size:11px;color:#333;margin-top:4px">
          ROD BR 354, KM 474, N¬∫ 749 - VILA CALCITA - ARCOS/MG - CEP: 35600-350
        </div>
      </div>
      <div style="text-align:right">
        <div style="font-weight:700">RELAT√ìRIO DI√ÅRIO DE SERVI√áO (RDS)</div>
        <div class="rds-meta" id="meta_data">DATA:</div>
        <div class="rds-meta" id="meta_hora_doc">HORA:</div>
      </div>
    </div>

    <table class="rds-table" style="margin-top:12px">
      <tr>
        <td><strong>CONTRATANTE:</strong><div id="meta_contratante"></div></td>
        <td><strong>SERVI√áO:</strong><div id="meta_servico"></div></td>
        <td><strong>F√ÅBRICA / LOCAL:</strong><div id="meta_fabrica"></div></td>
      </tr>
      <tr>
        <td><strong>HOR√ÅRIO DE TRABALHO:</strong><div id="meta_horario_trabalho"></div></td>
        <td><strong>TEMA (DDS):</strong><div id="meta_tema"></div></td>
        <td><strong>HOR√ÅRIO DO DDS:</strong><div id="meta_horario_dds"></div></td>
      </tr>
    </table>

    <table class="rds-table" id="rds_table_func" style="margin-top:12px">
      <thead>
        <tr>
          <th style="width:60px">C√ìDIGO</th>
          <th>NOME</th>
          <th style="width:80px">ENTRADA</th>
          <th style="width:80px">SA√çDA</th>
          <th>OBSERVA√á√ÉO</th>
        </tr>
      </thead>
      <tbody id="rds_func_rows"></tbody>
    </table>

    <div style="margin-top:10px;font-size:12px">
      <strong>DI√ÅLOGO DI√ÅRIO DE SEGURAN√áA (DDS)</strong>
      <div id="rds_dds" style="margin-top:6px;min-height:36px"></div>
    </div>

<div class="rds-foot">
  <div class="sig">
    <div class="line"></div>
    <div style="font-size:12px; text-align:center;">ASSINATURA ENCARREGADO DA CONTRATADA</div>
  </div>
  <div class="sig">
    <div class="line"></div>
    <div style="font-size:12px; text-align:center;">ASSINATURA GESTOR DO CONTRATO</div>
  </div>
</div>



<script>
// --- DATA E HORA AUTOM√ÅTICA ---
window.addEventListener('DOMContentLoaded', () => {
  function $(id){return document.getElementById(id)} // Fun√ß√£o $ definida antes de usar

  const now = new Date();
  const yyyy = now.getFullYear();
  const mm = String(now.getMonth() + 1).padStart(2, '0');
  const dd = String(now.getDate()).padStart(2, '0');
  $('rds_data').value = `${yyyy}-${mm}-${dd}`; // Agora funciona corretamente

  $('rds_hora_doc').value = now.toLocaleTimeString('pt-BR', {hour:'2-digit', minute:'2-digit'});
});


// --- FUNCION√ÅRIOS ---
  const funcionarios = [
  {codigo:"00225", nome:"WANTUIR BERTOLDO DA SILVA"},
  {codigo:"01350", nome:"MARIA DA CONCEICAO ARANTES"},
  {codigo:"01395", nome:"SANDRA APARECIDA VIEIRA SOUZA"},
  {codigo:"01450", nome:"SERGIO HENRIQUE SIMOES"},
  {codigo:"01462", nome:"ROSILENE ELIAS DE SOUZA"},
  {codigo:"01519", nome:"DJALMA DE SOUSA PRATES"},
  {codigo:"01532", nome:"EDINAR MELO DE SOUSA EDUARDO"},
  {codigo:"01541", nome:"SILVIO AUGUSTO DE ASSIS"},
  {codigo:"01542", nome:"PEDRO JOSE DA SILVA"},
  {codigo:"01566", nome:"VALQUIRIA DO NASCIMENTO DA SILVA"},
  {codigo:"01586", nome:"GENI ALVES XAVIER"},
  {codigo:"01648", nome:"JULIANA MARIA DE RESENDE ADRIANO"},
  {codigo:"01719", nome:"MARQUES CARLOS DE CASTRO"},
  {codigo:"01759", nome:"MARCOS BATISTA PEREIRA"},
  {codigo:"01767", nome:"VALDECIRO MELQUIADES DE OLIVEIRA"},
  {codigo:"01776", nome:"RICARDO JUNIO BELIZARIO"},
  {codigo:"01807", nome:"MICHELINE JOSE COUTINHO DO VALE"},
  {codigo:"01811", nome:"JOSE ANTONIO DA SILVA"},
  {codigo:"01818", nome:"ABGAIR DE JESUS DA SILVA"},
  {codigo:"01844", nome:"JANE OLIVEIRA GUSM√ÉO"},
  {codigo:"01849", nome:"JORDANIA APARECIDA LOPES"},
  {codigo:"01853", nome:"SERGIO MAXIMIANO DA SILVA"},
  {codigo:"01854", nome:"JOSE SOARES JUNIOR"},
  {codigo:"01857", nome:"DANIELE CAMPOS DE ASSUN√á√ÉO"},
  {codigo:"01886", nome:"NAIBIA MARIA SOUZA LIMA"},
  {codigo:"01900", nome:"EDER DE ARAUJO SILVA"},
  {codigo:"01906", nome:"JADER LUIS DA SILVA"},
  {codigo:"01908", nome:"JESSICA SILVA RIBEIRO"},
  {codigo:"01909", nome:"MARCELO AUGUSTO DE OLIVEIRA"},
  {codigo:"01911", nome:"MARCELO APARECIDO LACERDA"},
  {codigo:"01912", nome:"DIEGO JOSE RODRIGUES"},
  {codigo:"01915", nome:"DIOGO DUQUE MARCELINO"},
  {codigo:"01919", nome:"ISABELLA GONZAGA RIBEIRO"},
  {codigo:"01924", nome:"APARECIDA MANOEL DA COSTA RODRIGUES"},
  {codigo:"01925", nome:"RICARDO JUNIOR RIBEIRO MOURA"},
  {codigo:"01927", nome:"RONIELE CORREA MARTINS"},
  {codigo:"01928", nome:"LENILDO DOS SANTOS CHAVES"},
  {codigo:"01935", nome:"RILDO CANDIDO"},
  {codigo:"01937", nome:"EDVALDO VIEIRA DA SILVA"},
  {codigo:"01944", nome:"ADEONES PAULO DA SILVA"},
  {codigo:"01945", nome:"FERNANDA TEIXEIRA COUTO"},
  {codigo:"01946", nome:"PERP√âTUA APARECIDA MAR√áAL"},
  {codigo:"01955", nome:"DANIEL JUNIO MAR√áAL"},
  {codigo:"01957", nome:"ROGERIO EDUARDO OLIVEIRA"},
  {codigo:"01962", nome:"SIRLEIA REGINA DE FARIA SILVA"},
  {codigo:"01965", nome:"HENRIQUE MAGNO SANTOS ALMEIDA"},
  {codigo:"01967", nome:"IGOR APARECIDO GONZAGA"},
  {codigo:"01969", nome:"JULIANO UMBERTO DE SALES SILVA"},
  {codigo:"01970", nome:"JEANCARLOS JUNIOR DA SILVA"},
  {codigo:"01971", nome:"MONICA GON√áALVES COSTA"},
  {codigo:"01973", nome:"DAIANE LIMA NOGUEIRA"},
  {codigo:"01977", nome:"ISILEI DE FATIMA SILVA"},
  {codigo:"01979", nome:"CARLOS ALBERTO MARRERO MEDINA"},
  {codigo:"01981", nome:"GABRIEL DE PAULA MORAIS"},
  {codigo:"01982", nome:"CLEONE NASCIMENTO RODRIGUES"},
  {codigo:"01983", nome:"SANDRA APARECIDA BORGES"},
  {codigo:"01984", nome:"RENAN PAULINO ALVES GUIMARAES"},
  {codigo:"01987", nome:"VAGNER DOMINGOS DE MORAES"},
  {codigo:"01988", nome:"REINALDO FRANCISCO LOPES"},
  {codigo:"01989", nome:"MARIANA APARECIDA NUNES DE MELO"},
  {codigo:"01990", nome:"LUIS ANTONIO LOPES VELOSO"},
  {codigo:"01991", nome:"NATALIA MARCIANA DE OLIVEIRA SOUZA"},
  {codigo:"01992", nome:"DOUGLAS TEIXEIRA DOS SANTOS"},
  {codigo:"01993", nome:"BRUNO HENRIQUE MORAIS FERREIRA"},
  {codigo:"01994", nome:"MIRELLE DA SILVA RIBEIRO"},
  {codigo:"01996", nome:"HEITOR EUSTAQUIO ALVES"},
  {codigo:"01997", nome:"DAISIO APARECIDO OLIVEIRA"},
  {codigo:"01998", nome:"RHAONNI MEGARON QUEROBINO"},
  {codigo:"01999", nome:"GEOVANE DO AMARAL GOMES"},
  {codigo:"02000", nome:"WILLIAN DOS SANTOS EVANGELINO"},
  {codigo:"02001", nome:"FABIANO GERALDO MARTINS"},
  {codigo:"02002", nome:"EDER LUIS DUQUE"},
  {codigo:"02003", nome:"JO√ÉO VICTOR SANTOS"},
  {codigo:"02004", nome:"RODRIGO SOUZA AIRES"},
  {codigo:"02005", nome:"CRISTINA LOPES GOMES"},
  {codigo:"02006", nome:"JOSE MARIA DA COSTA"},
  {codigo:"02007", nome:"RAMON AUGUSTO DA SILVA COSTA"},
  {codigo:"02008", nome:"GABRIEL WHAGNOM NOGUEIRA LIMA"},
  {codigo:"02009", nome:"VANDER DE PAULA CANDIDO"},
  {codigo:"02010", nome:"MARDEN ALVES BATISTA"},
  {codigo:"02011", nome:"ANDER APARECIDO DA SILVA"},
  {codigo:"02012", nome:"EDEILSON ALVE PEREIRA"},
  {codigo:"02013", nome:"ISAC LIRIO LUIZ"},
  {codigo:"02014", nome:"PAULO HENRIQUE RODRIGUES DA SILVA"},
  {codigo:"02015", nome:"ROGERIO HENRIQUE BRITO DO PRADO"},
  {codigo:"02016", nome:"AGNALDO CRISPIM DA SILVA"},
  {codigo:"02017", nome:"ANNA VITORIA TAVARES DA PAIXAO"},
  {codigo:"02018", nome:"MAICON SANTOS LIMA"},
  {codigo:"02019", nome:"JUNIOR WESLEY MESSIAS"},
  {codigo:"02020", nome:"JUSCELINA GON√áALVES DE OLIVEIRA"},
  {codigo:"02021", nome:"EBERSON DAVID DA SILVA LIMA"},
  {codigo:"02022", nome:"GABRIELA MARTINS CALIXTO"},
  {codigo:"02023", nome:"GEYCILAYNE TELES SANTOS"},
  {codigo:"02024", nome:"ANDRE LOPES SILVA"},
  {codigo:"02025", nome:"JAQUELINE NAZARE ROMAO"},
  {codigo:"02026", nome:"WESLIAN XUXA SILVIA MELINDA SOARES DE PONTES"},
  {codigo:"02027", nome:"FLAVIA ALMEIDA ALVES SAMPAIO"},
  {codigo:"02028", nome:"BRUNO DOS REIS SOUSA"},
  {codigo:"02029", nome:"VALDER LEOPOLDINO OLIVEIRA MACHADO"},
  {codigo:"02030", nome:"AILAN ARNALDO VELOSO"},
  {codigo:"02031", nome:"IRANDI ROSA BRITO"},
  {codigo:"02032", nome:"EUGENIO FONSECA DA COSTA DIAS"},
  {codigo:"02033", nome:"TIAGO ALEXANDRE DA COSTA"},
  {codigo:"02034", nome:"PAULO HENRIQUE BRITO"},
  {codigo:"02035", nome:"ANDREA APARECIDA TOME DA SILVA"},
  {codigo:"02036", nome:"MARCOS ANTONIO GON√áALVES LOPES"},
  {codigo:"02037", nome:"CARLA APARECIDA DA SILVA"},
  {codigo:"02038", nome:"ANTONIO CARLOS DOS SANTOS GON√áALVES"},
  {codigo:"02039", nome:"RICARDO DONIZETTI PAIM"},
  {codigo:"02040", nome:"DOUGLAS NERI BORGES"},
  {codigo:"02041", nome:"PABLO HENRIQUE VELOSO"},
  {codigo:"02042", nome:"ALINE MARA CUNHA PAIXAO"},
  {codigo:"02043", nome:"LUIZ HENRIQUE DE SOUSA E SILVA"}
];




// --- FUN√á√ïES ---
const $ = id => document.getElementById(id);
const tblBody = document.querySelector('#tblFuncionarios tbody');

function criarSelectFuncionario(selected){
  const s=document.createElement('select');
  const opt=document.createElement('option');
  opt.value=""; opt.textContent="Selecione...";
  s.appendChild(opt);
  funcionarios.forEach(item=>{
    const o=document.createElement('option');
    o.value=item.nome;
    o.textContent=item.nome;
    if(selected===item.nome) o.selected=true;
    s.appendChild(o);
  });
  return s;
}

function addRow(data={}) {
  const tr=document.createElement('tr');
  const tdCodigo=document.createElement('td');
  const tdFuncionario=document.createElement('td');
  const inputCodigo=document.createElement('input');
  inputCodigo.type='text';
  inputCodigo.value=data.codigo||'';
  const selectFuncionario=criarSelectFuncionario(data.nome);
  inputCodigo.addEventListener('input',()=>{
    const f=funcionarios.find(x=>x.codigo===inputCodigo.value.trim());
    selectFuncionario.value=f?f.nome:'';
  });
  selectFuncionario.addEventListener('change',()=>{
    const f=funcionarios.find(x=>x.nome===selectFuncionario.value);
    inputCodigo.value=f?f.codigo:'';
  });
  tdCodigo.appendChild(inputCodigo);
  tdFuncionario.appendChild(selectFuncionario);
  tr.innerHTML+=`<td></td><td></td>
  <td><input type="text" placeholder="Entrada" style="width:100%"></td>
  <td><input type="text" placeholder="Sa√≠da" style="width:100%"></td>
  <td><input type="text" placeholder="Observa√ß√£o" style="width:100%"></td>
  <td><button class="remove-btn">Remover</button></td>`;
  tr.children[0].replaceWith(tdCodigo);
  tr.children[1].replaceWith(tdFuncionario);
  tr.querySelector('.remove-btn').onclick=()=>tr.remove();
  tblBody.appendChild(tr);
}

// cria 20 linhas iniciais
for(let i=0;i<20;i++) addRow({});
$('btnAdd').onclick=()=>addRow({});
$('btnLimpar').onclick=()=>{tblBody.innerHTML='';for(let i=0;i<20;i++) addRow({});};

// gerar PDF
$('btnGerarPDF').onclick=async()=>{
  const {jsPDF}=window.jspdf;
  const dataISO = $('rds_data').value; // yyyy-mm-dd
const [yyyy, mm, dd] = dataISO.split('-');
const dataObj = new Date(yyyy, mm-1, dd); // m√™s come√ßa em 0
const dataFormatada = `${String(dd).padStart(2,'0')}/${String(mm).padStart(2,'0')}/${yyyy}`;
  $('meta_data').innerText='DATA: '+dataFormatada;
  $('meta_hora_doc').innerText=$('rds_hora_doc').value;
  $('meta_contratante').innerText=$('rds_contratante').value;
  $('meta_servico').innerText=$('rds_servico').value;
  $('meta_fabrica').innerText=$('rds_fabrica').value;
  $('meta_horario_trabalho').innerText=$('rds_horario_trabalho').value;
  $('meta_tema').innerText=$('rds_tema').value;
  $('meta_horario_dds').innerText=$('rds_horario_dds').value;
  $('rds_dds').innerText=$('rds_tema').value;

  const tbody=$('rds_func_rows');
  tbody.innerHTML='';
  Array.from(tblBody.querySelectorAll('tr')).forEach(r=>{
  const tds=r.querySelectorAll('input,select');
  const entrada = tds[2].value.trim();
  const saida = tds[3].value.trim();
  const observacao = tds[4].value.trim();
  if(entrada || saida || observacao){
    const tr2=document.createElement('tr');
    tr2.innerHTML=`<td>${tds[0].value}</td><td>${tds[1].value}</td><td>${entrada}</td><td>${saida}</td><td>${observacao}</td>`;
    tbody.appendChild(tr2);
  }
});


  const wrapper=$('rds_report').cloneNode(true);
  wrapper.style.position='fixed';wrapper.style.left='-9999px';
  document.body.appendChild(wrapper);
  const canvas=await html2canvas(wrapper,{scale:2});
  const img=canvas.toDataURL('image/png');
  const pdf=new jsPDF({unit:'pt',format:'a4'});
  const w=pdf.internal.pageSize.width;
  const h=(canvas.height*w)/canvas.width;
  let pos=0, heightLeft=h;
  pdf.addImage(img,'PNG',0,pos,w,h);
  heightLeft-=pdf.internal.pageSize.height;
  while(heightLeft>0){pos-=pdf.internal.pageSize.height;pdf.addPage();pdf.addImage(img,'PNG',0,pos,w,h);heightLeft-=pdf.internal.pageSize.height;}
  pdf.save(`RDS_${$('rds_servico').value}_${dataFormatada}.pdf`);
  document.body.removeChild(wrapper);
};// üü¢ FUN√á√ÉO GERAR EXCEL
$('btnExcelRDS').addEventListener('click', gerarExcelRDS);

function gerarExcelRDS() {
  const data = $('rds_data').value;
  const hora = $('rds_hora_doc').value;
  const contratante = $('rds_contratante').value;
  const servico = $('rds_servico').value;
  const fabrica = $('rds_fabrica').value;
  const horarioTrabalho = $('rds_horario_trabalho').value;
  const tema = $('rds_tema').value;
  const horarioDDS = $('rds_horario_dds').value;

  const tbody = $('tblFuncionarios').querySelector('tbody');

  const linhasFunc = Array.from(tbody.querySelectorAll('tr')).map(tr => {
    const cells = tr.querySelectorAll('td');

    const entrada = cells[2].querySelector('input').value.trim();
    const saida = cells[3].querySelector('input').value.trim();
    const observacao = cells[4].querySelector('input').value.trim();

    // C√≥digo e Nome aparecem apenas se Entrada ou Sa√≠da preenchido
    // pegar c√≥digo do input e nome do select
const inputCodigo = cells[0].querySelector('input');
const selectNome = cells[1].querySelector('select');

const codigo = (entrada || saida) ? (inputCodigo ? inputCodigo.value.trim() : '') : '';
const nome = (entrada || saida) ? (selectNome ? selectNome.value.trim() : '') : '';


    return {
      Codigo: codigo,
      Nome: nome,
      Entrada: entrada,
      Saida: saida,
      Observacao: observacao
    };
  }).filter(f => f.Entrada || f.Saida || f.Observacao); // remove linhas totalmente vazias

  const linhas = linhasFunc.map(f => ({
    Data: data.split('-').reverse().join('/'),
    Hora: hora,
    Contratante: contratante,
    Servico: servico,
    Fabrica: fabrica,
    HorarioTrabalho: horarioTrabalho,
    TemaDDS: tema,
    HorarioDDS: horarioDDS,
    Codigo: f.Codigo,  // Coluna I ‚Üí C√≥digo
    Nome: f.Nome,      // Coluna J ‚Üí Nome
    Entrada: f.Entrada,
    Saida: f.Saida,
    Observacao: f.Observacao
  }));

  const nomeArquivo = `RDS_${servico.replace(/[^a-z0-9]/gi,'_')}_${data}_${hora.replace(':','-')}.xlsx`;

  const ws = XLSX.utils.json_to_sheet(linhas);
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, 'RDS');
  XLSX.writeFile(wb, nomeArquivo);

  alert('‚úÖ Excel gerado com sucesso! Verifique sua pasta de downloads.');
}


</script>
</body>
</html>
